<div class="clinical-history-container">
  <!-- Header del historial m√©dico -->
  <div class="header">
    <div class="header-content">
      <h2 class="page-title">
        <i class="fas fa-stethoscope"></i>
        Historial Cl√≠nico del M√©dico
      </h2>
      <p class="page-description">
        Registro completo de todas las citas m√©dicas atendidas
      </p>
    </div>
    
    <!-- Controles de vista -->
    <div class="view-controls">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Buscar por paciente, motivo..." [(ngModel)]="searchTerm" (input)="filterAppointments()">
      </div>
      
      <div class="filter-controls">
        <select [(ngModel)]="statusFilter" (change)="filterAppointments()" class="filter-select">
          <option value="">Todos los estados</option>
          <option value="completed">Completadas</option>
          <option value="cancelled">Canceladas</option>
          <option value="scheduled">Programadas</option>
        </select>
        
        <select [(ngModel)]="priorityFilter" (change)="filterAppointments()" class="filter-select">
          <option value="">Todas las prioridades</option>
          <option value="high">Alta</option>
          <option value="medium">Media</option>
          <option value="low">Baja</option>
        </select>
      </div>
      
      <div class="action-buttons">
        <button class="btn-refresh" (click)="loadAppointmentsByPhysician()">
          <i class="fas fa-sync-alt"></i>
        üîÑÔ∏èActualizar
        </button>
        <button class="btn-back" (click)="goToPhysicianDashboard()">
          <i class="fas fa-arrow-left"></i>
          üè† Volver al Dashboard
        </button>
      </div>
    </div>
  </div>

  <!-- Estad√≠sticas r√°pidas -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon completed">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ getCompletedCount() }}</span>
        <span class="stat-label">Completadas</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon total">
        <i class="fas fa-calendar-alt"></i>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ filteredAppointments.length }}</span>
        <span class="stat-label">Total de Citas</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon priority">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ getHighPriorityCount() }}</span>
        <span class="stat-label">Alta Prioridad</span>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon patients">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-content">
        <span class="stat-number">{{ getUniquePatients() }}</span>
        <span class="stat-label">Pacientes √önicos</span>
      </div>
    </div>
  </div>

  <!-- Tabla de historial -->
  <div class="history-table-container">
    <div class="table-header">
      <h3>
        <i class="fas fa-history"></i>
        Registro de Citas M√©dicas
      </h3>
      <span class="results-count">
        Mostrando {{ filteredAppointments.length }} de {{ appointments.length }} citas
      </span>
    </div>

    <div class="table-wrapper" *ngIf="filteredAppointments.length > 0; else noAppointments">
      <table class="history-table">
        <thead>
          <tr>
            <th (click)="sortBy('patientFullName')" class="sortable">
              <span>Paciente</span>
              <i class="fas fa-sort"></i>
            </th>
            <th (click)="sortBy('date')" class="sortable">
              <span>Fecha</span>
              <i class="fas fa-sort"></i>
            </th>
            <th (click)="sortBy('time')" class="sortable">
              <span>Hora</span>
              <i class="fas fa-sort"></i>
            </th>
            <th>Motivo</th>
            <th (click)="sortBy('status')" class="sortable">
              <span>Estado</span>
              <i class="fas fa-sort"></i>
            </th>
            <th (click)="sortBy('priority')" class="sortable">
              <span>Prioridad</span>
              <i class="fas fa-sort"></i>
            </th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let appointment of filteredAppointments; let i = index" 
              class="appointment-row"
              [attr.data-status]="appointment.status">
            <td class="patient-cell">
              <div class="patient-info">
                <div class="patient-avatar">
                  <i class="fas fa-user"></i>
                </div>
                <div class="patient-details">
                  <span class="patient-name">{{ appointment.patientFullName }}</span>
                  <span class="patient-id">ID: {{ appointment.patient_id }}</span>
                </div>
              </div>
            </td>
            
            <td class="date-cell">
              <div class="date-info">
                <span class="date">{{ appointment.date }}</span>
                <span class="day">{{ getDayOfWeek(appointment.date) }}</span>
              </div>
            </td>
            
            <td class="time-cell">
              <span class="time">{{ appointment.time }}</span>
            </td>
            
            <td class="reason-cell">
              <div class="reason-text" [title]="appointment.reason">
                {{ appointment.reason | slice:0:50 }}{{ appointment.reason.length > 50 ? '...' : '' }}
              </div>
            </td>
            
            <td class="status-cell">
              <span class="status-badge" [ngClass]="'status-' + appointment.status">
                <i [class]="getStatusIcon(appointment.status)"></i>
                {{ getStatusText(appointment.status) }}
              </span>
            </td>
            
            <td class="priority-cell">
              <span class="priority-badge" [ngClass]="'priority-' + appointment.priority">
                <i [class]="getPriorityIcon(appointment.priority)"></i>
                {{ getPriorityText(appointment.priority) }}
              </span>
            </td>
            
            <td class="actions-cell">
              <div class="action-buttons-row">
                <button class="btn-action btn-view"
                        (click)="viewAppointmentDetails(appointment)"
                        title="Ver detalles ">üëÅÔ∏è
                  <i class="fas fa-eye "></i>
                </button>
                <button class="btn-action btn-notes" 
                        (click)="viewNotes(appointment)"
                        title="Ver notas m√©dicas"
                        *ngIf="appointment.status === 'completed'">
                        AAAAAAAAAAAAAAAAAAAAA
                  <i class="fas fa-file-medical"></i>
                </button>
                <button class="btn-action btn-edit" 
                        (click)="editAppointment(appointment)"
                        title="Editar cita"
                        *ngIf="appointment.status !== 'completed'">‚úèÔ∏è
                  <i class="fas fa-edit"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Estado vac√≠o -->
    <ng-template #noAppointments>
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-calendar-times"></i>
        </div>
        <h3>No se encontraron citas</h3>
        <p>No hay citas m√©dicas que coincidan con los filtros seleccionados.</p>
        <button class="btn-primary" (click)="clearFilters()">
          <i class="fas fa-filter"></i>
          Limpiar Filtros
        </button>
      </div>
    </ng-template>
  </div>
</div>